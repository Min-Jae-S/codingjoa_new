<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.codingjoa.mapper.AdminMapper">

	<!-- <resultMap type="map" id="boardInfoMap">
		<association property="board" javaType="Board">
			<id column="board_idx" property="boardIdx" />
			<result column="board_writer_idx" property="boardWriterIdx" />
			<result column="board_title" property="boardTitle" />
			<result column="board_content" property="boardContent" />
			<result column="board_content_text" property="boardContentText" />
			<result column="board_category_code" property="boardCategoryCode" />
			<result column="board_views" property="boardViews" />
			<result column="created_at" property="createdAt" />
			<result column="updated_at" property="updatedAt" />
		</association>
		<association property="category" javaType="Category">
			<id column="catergory_code" property="categoryCode" />
			<result column="catergory_parent_code" property="catergoryParentCode" />
			<result column="catergory_name" property="catergoryName" />
			<result column="category_path" property="categoryPath" />
		</association>
		<association property="writer" javaType="Member">
			...
		</association>
	</resultMap> -->

	<select id="findPagedBoards" parameterType="map" resultType="boardInfo">
		SELECT 
			a.*, 
			b.*, 
			c.*,
			NVL(d.cnt, 0) AS comment_cnt,
    		NVL(e.cnt, 0) AS board_likes_cnt
		FROM
			board a
		INNER JOIN
			category b
		ON
			a.board_category_code = b.category_code
		INNER JOIN
			member c
		ON
			a.board_writer_idx = c.member_idx
		LEFT OUTER JOIN (
			SELECT 
				board_idx, 
				COUNT(*) cnt
			FROM
				"comment"
			GROUP BY 
				board_idx
		) d
		ON 
			a.board_idx = d.board_idx
		LEFT OUTER JOIN ( 
			SELECT 
    			board_idx,
    			COUNT(*) cnt
    		FROM 
    			board_likes
    		GROUP BY 
				board_idx
    	) e
		ON 
			a.board_idx = e.board_idx
	</select>
</mapper>