<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.codingjoa.mapper.UploadMapper">
<!--  
	board_image_idx         NUMBER,
	board_idx               NUMBER              NULL,
	board_image_name        VARCHAR2(500)       NOT NULL,
	regdate                 DATE                NOT NULL,
-->

	<insert id="insertBoardImage" parameterType="boardImage">
		<selectKey keyProperty="boardImageIdx" resultType="int" order="BEFORE">
			SELECT seq_board_image.NEXTVAL FROM DUAL
		</selectKey>
		
		INSERT INTO board_image (
			board_image_idx,
			board_idx,
			board_image_name,
			board_image_path,
			regdate
		) VALUES (
			#{boardImageIdx},
			#{boardIdx},
			#{boardImageName},
			#{boardImagePath}
			SYSDATE
		)
	</insert>
	
	<select id="isBoardImageUploaded" parameterType="int" resultType="boolean">
		SELECT
			COUNT(*)
		FROM
			board_image
		WHERE
			board_image_idx = #{boardImageIdx}
	</select>
	
	<update id="activateBoardImage" parameterType="map">
		UPDATE 
			board_image
		SET
			board_idx = #{boardIdx}
		WHERE
			board_image_idx IN 
			<foreach collection="boardImages" item="boardImageIdx" separator="," open="(" close=")">	
				#{boardImageIdx}
			</foreach>
	</update>
	
	<update id="deactivateBoardImage" parameterType="int">
		UPDATE 
			board_image
		SET
			board_idx = ''
		WHERE
			board_idx = #{boardIdx} 
	</update>
	
	<select id="findBoardImagesByBoardIdx" parameterType="int" resultType="boardImage">
		SELECT
			*
		FROM
			board_image
		WHERE
			board_idx = #{boardIdx}
	</select>
	
</mapper>